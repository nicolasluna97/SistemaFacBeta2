<app-navbar></app-navbar>
<app-sidenav></app-sidenav>

<div class="page-content">
  <div class="page-header">
    <h1 class="page-title">Movimientos</h1>
  </div>

  <div class="card filters-card">
    <div class="filters-row">
      <div class="filters-left">
        <label class="filter-label">Mostrar</label>

        <select
          class="filter-select"
          [value]="range()"
          (change)="onChangeRange($any($event.target).value)"
        >
          <option value="24h">Las últimas 24 horas</option>
          <option value="7d">Última semana</option>
          <option value="all">Todos los movimientos</option>
        </select>

        <button class="btn btn-primary" type="button" (click)="search(1)">
          Buscar
        </button>
      </div>

      <div class="filters-right" *ngIf="!loading() && !error()">
        <span class="muted">
          Total: <strong>{{ total() }}</strong>
        </span>
      </div>
    </div>
  </div>

  <div *ngIf="loading()" class="status-line">
    Cargando movimientos...
  </div>

  <div *ngIf="error()" class="alert alert-danger">
    {{ error() }}
  </div>

  <div *ngIf="!loading() && !error() && !movements().length" class="empty">
    No hay movimientos para mostrar.
  </div>

  <div *ngIf="!loading() && movements().length" class="card table-card">
    <div class="table-wrap">
      <table class="table table-modern">
        <thead>
          <tr>
            <th class="col-client">Cliente</th>
            <th class="col-product">Producto</th>
            <th class="col-price">Precio</th>
            <th class="col-date">Fecha</th>
            <th class="col-status">Estado</th>
            <th class="col-employee">Empleado</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let m of movements()">
            <td class="col-client">
              <div class="cell-main">{{ m.customerName }}</div>
            </td>

            <td class="col-product">
              <div class="cell-main">{{ m.productTitle }}</div>
            </td>

            <td class="col-price">
              <div class="cell-main">
                {{ m.unitPrice | number:'1.0-2' }}
              </div>
              <div class="cell-sub">
                ({{ formatPriceLabel(m.priceKey) }})
              </div>
            </td>

            <td class="col-date">
              <div class="cell-main">
                {{ m.createdAt | date:'HH:mm - dd/MM/yyyy' }}
              </div>
            </td>

            <td class="col-status">
              <span class="pill" [class.pill-empty]="!m.status">
                {{ m.status || '—' }}
              </span>
            </td>

            <td class="col-employee">
              <span class="pill" [class.pill-empty]="!m.employee">
                {{ m.employee || '—' }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="table-footer">
      <button
        class="btn btn-light"
        type="button"
        [disabled]="!canPrev()"
        (click)="prevPage()"
      >
        Anterior
      </button>

      <div class="page-indicator">
        Página <strong>{{ page() }}</strong> de <strong>{{ totalPages() }}</strong>
      </div>

      <button
        class="btn btn-light"
        type="button"
        [disabled]="!canNext()"
        (click)="nextPage()"
      >
        Siguiente
      </button>
    </div>
  </div>
</div>
