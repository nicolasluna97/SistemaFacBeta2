<app-navbar></app-navbar>
<app-sidenav></app-sidenav>

<div class="page-content">
  <h1 class="page-title">Movimientos</h1>

  <div class="filters">
    <label class="filter-label">Mostrar:</label>

    <!-- Dropdown / lista desplegable -->
    <select class="filter-select"
            [value]="range()"
            (change)="onChangeRange($any($event.target).value)">
      <option value="24h">Las últimas 24 horas</option>
      <option value="7d">Última semana</option>
      <option value="all">Todos los movimientos</option>
    </select>

    <button class="btn btn-primary"
            type="button"
            (click)="search(1)">
      Buscar
    </button>
  </div>

  <p *ngIf="loading()">Cargando movimientos...</p>

  <div *ngIf="error()" class="alert alert-danger">
    {{ error() }}
  </div>

  <div *ngIf="!loading() && !error() && !movements().length" class="empty">
    No hay movimientos para mostrar.
  </div>

  <div *ngIf="!loading() && movements().length" class="card">
    <div class="card-body">
      <table class="table">
        <thead>
          <tr>
            <th>Cliente</th>
            <th>Producto</th>
            <th>Precio</th>
            <th>Fecha</th>
            <th>Estado</th>
            <th>Empleado</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let m of movements()">
            <td>{{ m.customerName }}</td>
            <td>{{ m.productTitle }}</td>
            <td>
              {{ m.unitPrice | number:'1.0-2' }}
              ({{ formatPriceLabel(m.priceKey) }})
            </td>
            <td>{{ m.createdAt | date:'HH:mm - dd/MM/yyyy' }}</td>
            <td>{{ m.status || '' }}</td>
            <td>{{ m.employee || '' }}</td>
          </tr>
        </tbody>
      </table>

      <div class="pagination">
        <button class="btn btn-light"
                type="button"
                [disabled]="!canPrev()"
                (click)="prevPage()">
          Anterior
        </button>

        <span class="page-indicator">
          Página {{ page() }} de {{ totalPages() }} ({{ total() }} movimientos)
        </span>

        <button class="btn btn-light"
                type="button"
                [disabled]="!canNext()"
                (click)="nextPage()">
          Siguiente
        </button>
      </div>
    </div>
  </div>
</div>
